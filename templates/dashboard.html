{% extends 'layout.html' %}

{% block title %}Dashboard{% endblock %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Bagian Profil Pengguna -->
    <div class="user-profile-container card">
        <span class="profile-icon">
            <img src="{{ url_for('static', filename='img/' + session['user']['profile_data']['avatar']) }}" alt="Avatar">
        </span>
        <div class="user-profile">
            <h1>{{ session['user']['firstName'] }} {{ session['user']['lastName'] }}</h1>
            <h2>{{ session['user']['role'] }} | {{ session['user']['profile_data']['job'] }}</h2>
        </div>
    </div>

    <!-- Bagian Saldo dan Topup -->
    <div class="user-payment-container card">
        <div class="user-payment-desc">
            <h1>Saldo FriPay</h1>
            <h2>Rp 5.000.000,00</h2>
        </div>
        <div class="user-payment-topup">
            <div class="action-button">
                <span>✅</span>
                <h3>Cairkan Dana</h3>
            </div>
            <div class="action-button">
                <span>⚠️</span>
                <h3>Laporkan Masalah</h3>
            </div>
        </div>
    </div>

    <!-- Bagian Rating Pengguna -->
    <div class="user-rating card">
        <span class="rating-icon">⭐</span>
        <div class="user-rating-desc">
            <p>4.5/5.0</p>
            <p>Positive Rating</p>
        </div>
    </div>
</div>

<!-- Form Upload Projects -->
{% if session['user']['role'] == 'hirer' %}
<div class="upload-container">
    <h2 class="upload-title">Upload Projects</h2>
    <form class="upload-form" action="{{ url_for('create_project') }}" method="POST">
        <input type="text" name="title" class="upload-input" placeholder="Judul Project" required>
        <input type="text" name="description" class="upload-input" placeholder="Deskripsi" required>
        <input type="number" name="price" class="upload-input" placeholder="Harga Project" required>
        
        <!-- Ganti input text untuk bidang menjadi select -->
        <select name="bidang" class="upload-input" required>
            <option value="">Pilih Industri</option>
            {% for industry in industries %}
                <option value="{{ industry }}">{{ industry }}</option>
            {% endfor %}
        </select>
        
        <button type="submit" class="upload-button">Create</button>
    </form>
</div>

{% endif %}


<!-- Daftar Ongoing Projects -->
<div class="ongoing-projects-container">
    <div class="ongoing-projects-header">
        <span>Ongoing Projects</span>
        <a href="#"></a>
    </div>
    <div id="projects-container">
        {% if projects|length == 0 %}
            <p>No projects available.</p>
        {% else %}
            {% for project in projects %}
            <div class="project-card">
                <div class="project-title">{{ project.title }}</div>
                <div class="project-deadline">
                    Created at: {{ project.created_at.strftime("%d %B %Y") if project.created_at else "N/A" }}
                </div>
                <div class="project-industry">
                    Industry: {{ project.bidang }}
                </div>
                <div class="project-profile">
                    <div>
                        <div class="project-name">{{ project.created_by }}</div>
                        <div class="project-stars">
                            {% if project.rating %}
                                {{ "★" * project.rating + "☆" * (5 - project.rating) }}
                            {% else %}
                                ☆☆☆☆☆
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="project-price">Rp. {{ project.price }}</div>
                <div class="project-arrow">&#10132;</div>
            </div>
            {% endfor %}
        {% endif %}
    </div>
</div>



{% endblock %}

{% block scripts %}
<script>
    // Jika Anda ingin melakukan render dengan JavaScript, 
    // Anda dapat menggunakan kode di bawah ini sebagai alternatif.
    /*
    const projects = {{ projects | tojson | safe }};
    
    function renderProjects() {
        const container = document.getElementById("projects-container");
        container.innerHTML = "";
    
        if (projects.length === 0) {
            container.innerHTML = "<p>No projects available.</p>";
            return;
        }
    
        projects.forEach(project => {
            const rating = project.rating || 0;
            const stars = "★".repeat(rating) + "☆".repeat(5 - rating);
            const createdAt = new Date(project.created_at).toLocaleDateString('id-ID', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const formattedPrice = "Rp. " + project.price;
    
            const projectHTML = `
                <div class="project-card">
                    <div class="project-title">${project.title}</div>
                    <div class="project-deadline">Created at: ${createdAt}</div>
                    <div class="project-profile">
                        <div>
                            <div class="project-name">{{ session['user']['username'] }}</div>
                            <div class="project-stars">${stars}</div>
                        </div>
                    </div>
                    <div class="project-price">${formattedPrice}</div>
                    <div class="project-arrow">&#10132;</div>
                </div>
            `;
            container.innerHTML += projectHTML;
        });
    }
    
    document.addEventListener("DOMContentLoaded", renderProjects);
    */
</script>
{% endblock %}
